# Default values for osm-device-adapter
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 2

image:
  repository: your-registry/osm-device-adapter
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: false
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext: {}
  # fsGroup: 2000

securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

service:
  type: ClusterIP
  port: 80
  targetPort: 8080

ingress:
  enabled: false
  className: "cloudflare-tunnel"
  annotations:
    external-dns.alpha.kubernetes.io/cloudflare-proxied: "true"
    # kubernetes.io/ingress.class: cloudflare-tunnel
  hosts:
    - host: osm-adapter.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: osm-adapter-tls
  #    hosts:
  #      - osm-adapter.example.com

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

affinity: {}

# Application configuration
config:
  # Server configuration
  port: 8080
  host: "0.0.0.0"

  # External domain where the service is exposed (REQUIRED)
  # Example: https://osm-adapter.example.com
  exposedDomain: "https://osm-adapter.example.com"

  # Online Scout Manager domain
  osmDomain: "https://www.onlinescoutmanager.co.uk"

  # Device OAuth configuration
  deviceCodeExpiry: 300       # seconds (5 minutes)
  devicePollInterval: 5       # seconds

  # Allowed client IDs that can use the device flow (empty list allows all)
  allowedClientIds: []

  # Rate limiting configuration for OAuth endpoints
  deviceRateLimit:
    # Maximum requests per minute per IP for /device/authorize
    authorize: 6
    # Seconds between device entry submissions per IP (for /device endpoint)
    entry: 5

  # Cache configuration for patrol scores
  cache:
    # How long to keep stale data in Redis for emergency use (seconds)
    # Default: 691200 (8 days - optimized for weekly scout meetings)
    fallbackTTL: 691200

  # Rate limiting thresholds for dynamic cache TTL
  rateLimit:
    # Remaining requests threshold to start extending cache TTL
    caution: 200
    # Remaining requests threshold for further cache TTL extension
    warning: 100
    # Remaining requests threshold for maximum cache TTL extension
    critical: 20

# Database configuration
database:
  # PostgreSQL connection URL
  # If using existing secret, leave this empty and set existingSecret
  url: ""
  # Use an existing secret for database URL
  # The secret should contain a key 'database-url'
  existingSecret: ""

# Redis configuration
redis:
  # Redis connection URL
  url: "redis://redis-service:6379"
  # Redis key prefix (optional)
  keyPrefix: ""
  # Use an existing secret for Redis URL
  # The secret should contain a key 'redis-url'
  existingSecret: ""

# OSM OAuth credentials
osm:
  # OAuth client ID (REQUIRED)
  clientId: ""
  # OAuth client secret (REQUIRED)
  clientSecret: ""
  # OAuth redirect URI (optional, defaults to exposedDomain/oauth/callback)
  redirectUri: ""

  # Use an existing secret for OSM credentials
  # The secret should contain keys: 'osm-client-id', 'osm-client-secret'
  existingSecret: ""

# Probes configuration
livenessProbe:
  httpGet:
    path: /health
    port: health
  initialDelaySeconds: 10
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /ready
    port: health
  initialDelaySeconds: 5
  periodSeconds: 5

# Observability configuration
observability:
  # Structured logging
  logging:
    level: info  # debug, info, warn, error
    format: json # json or text

  # Prometheus metrics
  metrics:
    enabled: true
    port: 9090
    path: /metrics

  # Prometheus ServiceMonitor (requires Prometheus Operator)
  serviceMonitor:
    enabled: true
    interval: 30s
