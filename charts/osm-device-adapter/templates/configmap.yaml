apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "osm-device-adapter.fullname" . }}
  labels:
    {{- include "osm-device-adapter.labels" . | nindent 4 }}
data:
  exposed-domain: {{ .Values.config.exposedDomain | quote }}
  osm-domain: {{ .Values.config.osmDomain | quote }}
  device-code-expiry: {{ .Values.config.deviceCodeExpiry | quote }}
  device-poll-interval: {{ .Values.config.devicePollInterval | quote }}
  allowed-client-ids: {{ .Values.config.allowedClientIds | join "," | quote }}
  # Path configuration for endpoint obscurity
  {{- if .Values.config.paths.oauthPrefix }}
  oauth-path-prefix: {{ .Values.config.paths.oauthPrefix | quote }}
  {{- end }}
  {{- if .Values.config.paths.devicePrefix }}
  device-path-prefix: {{ .Values.config.paths.devicePrefix | quote }}
  {{- end }}
  {{- if .Values.config.paths.apiPrefix }}
  api-path-prefix: {{ .Values.config.paths.apiPrefix | quote }}
  {{- end }}
  # Device endpoint rate limiting
  device-authorize-rate-limit: {{ .Values.config.deviceRateLimit.authorize | quote }}
  device-entry-rate-limit: {{ .Values.config.deviceRateLimit.entry | quote }}
  # Cache configuration
  cache-fallback-ttl: {{ .Values.config.cache.fallbackTTL | quote }}
  # OSM API rate limiting thresholds for dynamic cache TTL
  rate-limit-caution: {{ .Values.config.rateLimit.caution | quote }}
  rate-limit-warning: {{ .Values.config.rateLimit.warning | quote }}
  rate-limit-critical: {{ .Values.config.rateLimit.critical | quote }}
  {{- if .Values.osm.redirectUri }}
  osm-redirect-uri: {{ .Values.osm.redirectUri | quote }}
  {{- end }}
  {{- if .Values.redis.keyPrefix }}
  redis-key-prefix: {{ .Values.redis.keyPrefix | quote }}
  {{- end }}
