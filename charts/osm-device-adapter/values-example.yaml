# Example values file for OSM Device Adapter
# Copy this file and customize it for your environment
# Usage: helm install osm-device-adapter ./charts/osm-device-adapter -f values-production.yaml

replicaCount: 2

image:
  repository: ghcr.io/your-org/osm-device-adapter
  pullPolicy: IfNotPresent
  tag: "1.0.0"

# Application configuration
config:
  # REQUIRED: Your public domain where the service is exposed
  exposedDomain: "https://osm-adapter.example.com"

  # OSM domain (usually doesn't need to change)
  osmDomain: "https://www.onlinescoutmanager.co.uk"

  # Device OAuth configuration
  deviceCodeExpiry: 300       # 5 minutes (shortened for security)
  devicePollInterval: 5       # 5 seconds

  # REQUIRED: List of allowed OAuth client IDs that can use this service
  allowedClientIds:
    - "scoreboard-device-123"
    - "scoreboard-device-456"

  # Path configuration (for security through obscurity - makes endpoints less predictable)
  paths:
    # OAuth web flow path prefix (default: /oauth)
    oauthPrefix: "/oauth"
    # Device flow path prefix (default: /device)
    devicePrefix: "/device"
    # API endpoints path prefix (default: /api)
    apiPrefix: "/api"

  # Rate limiting configuration for OAuth endpoints (protects against abuse)
  deviceRateLimit:
    # Maximum requests per minute per IP for /device/authorize
    # Prevents rapid device authorization attempts
    authorize: 6
    # Seconds between device entry submissions per IP (for /device endpoint)
    # Prevents rapid code guessing attempts
    entry: 5

  # Cache configuration for patrol scores
  cache:
    # How long to keep stale data in Redis for emergency use (seconds)
    # Default: 691200 (8 days - optimized for weekly scout meetings)
    # This allows the service to serve stale data during OSM outages or blocking
    fallbackTTL: 691200

  # Rate limiting thresholds for dynamic cache TTL
  # These control how aggressively the service extends cache TTL based on OSM rate limits
  rateLimit:
    # When remaining requests drop below this, start extending cache TTL to 10 minutes
    caution: 200
    # When remaining requests drop below this, extend cache TTL to 15 minutes
    warning: 100
    # When remaining requests drop below this, extend cache TTL to 30 minutes
    critical: 20

# Database configuration
database:
  # PostgreSQL connection URL
  url: "postgres://osmadapter:yourpassword@postgres.database.svc.cluster.local:5432/osmdeviceadapter?sslmode=require"

  # OR use an existing secret
  # existingSecret: "database-credentials"

# Redis configuration
redis:
  url: "redis://redis.cache.svc.cluster.local:6379"

  # OR use an existing secret
  # existingSecret: "redis-credentials"

# OSM OAuth credentials (REQUIRED)
osm:
  clientId: "your-osm-client-id-here"
  clientSecret: "your-osm-client-secret-here"

  # Optional: Override redirect URI (defaults to exposedDomain/oauth/callback)
  # redirectUri: "https://osm-adapter.example.com/oauth/callback"

  # OR use an existing secret
  # existingSecret: "osm-oauth-credentials"

# Ingress configuration (optional - not needed if using Cloudflare Tunnel)
ingress:
  enabled: false
  # If you need ingress, set enabled: true and configure:
  # className: "cloudflare-tunnel"
  # hosts:
  #   - host: osm-adapter.example.com
  #     paths:
  #       - path: /
  #         pathType: Prefix

# Resource limits
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Autoscaling (optional)
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
